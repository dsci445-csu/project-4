    Working with Git Project:
    1. Make sure project is set to D445_Project in RStudio
    2. In RStudio Console:
        getwd() = Verify working directory is set to this project
        setwd() = Can change working directory to this path
        list.files() = Can verify the files are available
    3. In RStudio Terminal:
        cd <destination> = Change directory
        cd - = Go back to previous directory
        ls = Lists contents of current directory
        git init = Initialize git connection
        git status = Check what status needs to be changed before comitting
          - git  add <file>
          - git rm <file>
          - git restore <file>
        git commit -m "" = Commit changes from terminal with message
        git push = Publish local changes
    4. Might need to open GitHub Desktop and verify changes.

```{r}
#############
# Libraries #
#############

library(dplyr)
library(ggplot2)
```

Creating dfs for the price, number of daily bike trips, and the number of daily scooter trips taken over our entire data period.

```{r}
data_dir <- 'FOCO Spin Data'

## https://public.ridereport.com/fortcollins
# df_daily_bike_trips <- data.frame(read.csv(file.path(data_dir,"bikes 2021-07-26--2024-10-17-analyze-trips_by_date.csv")))
# df_hourly_price_rate <- data.frame(read.csv(file.path(data_dir,"spin-prices.csv")))
# date_deploy <- c("2021-07-26", "2022-11-01", "2023-07-01", "2024-07-01")
# scooter_deploy <- c(500, 500, 540, 630)
# df_sccooters_deployed <- data.frame(Date = date_deploy, 
#                                     Scooters = scooter_deploy)

df_daily_scooter_trips <- data.frame(read.csv(file.path(data_dir,"scooters 2021-07-26--2024-10-17-analyze-trips_by_date.csv")))

## data from July 2021 to December 2021
df_matched_2021_q3 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2021-Q3.csv")),
                         stringsAsFactors = FALSE)
df_matched_2021_q4 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2021-Q4.csv")),
                         stringsAsFactors = FALSE)
df_matched_2022_q1 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2022-Q1.csv")),
                         stringsAsFactors = FALSE)
df_matched_2022_q2 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2022-Q2.csv")),
                         stringsAsFactors = FALSE)
df_matched_2022_q3 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2022-Q3.csv")),
                         stringsAsFactors = FALSE)
df_matched_2022_q4 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2022-Q4.csv")),
                         stringsAsFactors = FALSE)

## data from January 2023 to June 2024
df_matched_2023_q1 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2023-Q1.csv")),
                         stringsAsFactors = FALSE)
df_matched_2023_q2 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2023-Q2.csv")),
                         stringsAsFactors = FALSE)
df_matched_2023_q3 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2023-Q3.csv")),
                         stringsAsFactors = FALSE)
df_matched_2023_q4 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2023-Q4.csv")),
                         stringsAsFactors = FALSE)
df_matched_2024_q1 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2024-Q1.csv")),
                         stringsAsFactors = FALSE)
df_matched_2024_q2 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2024-Q2.csv")),
                         stringsAsFactors = FALSE)

## data from July 2024 to September 2023
df_matched_2024_q3 <- data.frame(read.csv(file.path(data_dir, "E_fortcollins-routes-data-for-scooter-in-2024-Q3.csv")),
                         stringsAsFactors = FALSE)
```

```{r}
price_change_1 <- as.Date("2021-07-26")
price_change_2 <- as.Date("2022-12-01")
price_change_3 <- as.Date("2024-07-01")
df_daily_scooter_trips$Date <- as.Date(df_daily_scooter_trips$Date)
daily_date <- df_daily_scooter_trips$Date
daily_trips <- df_daily_scooter_trips$Trips.By.Date...Starts...Spin...Scooters
plot_scooter_rides_daily <- ggplot(data = df_daily_scooter_trips,
                                   mapping = aes(x = daily_date, 
                                                 y = daily_trips)) +
  geom_line() +
  theme_light() +
  scale_x_continuous(breaks = pretty(daily_date, n = 8)) +
  geom_vline(xintercept = price_change_1, color = "blue") +
  geom_vline(xintercept = price_change_2, color = "blue") +
  geom_vline(xintercept = price_change_3, color = "blue") +
  # annotate("text", x=9.7, y=20, label="Some text", angle=90) +
  labs(x = "Date",
       y = "Number of Rides",
       title = "Number of Rides Taken on Spin Scooters")
plot_scooter_rides_daily
```

```{r}
df_p1 <- rbind(df_matched_2021_q3, df_matched_2021_q4,
               df_matched_2022_q1, df_matched_2022_q2,
               df_matched_2022_q3, df_matched_2022_q4)

df_p2 <- rbind(df_matched_2023_q1, df_matched_2023_q2,
               df_matched_2023_q3, df_matched_2023_q4,
               df_matched_2024_q1, df_matched_2024_q2)

df_p3 <- df_matched_2024_q3

data_list <- list(df_p1, df_p2, df_p3)

for (i in seq_along(data_list)) {
  df <- data_list[[i]]
  df$Count.of.Matched.Trips <- gsub(",", "", df$Count.of.Matched.Trips)
  df$Count.of.Matched.Trips <- gsub("< 100", "50", 
                                    df$Count.of.Matched.Trips)
  df$Count.of.Matched.Trips <- as.numeric(df$Count.of.Matched.Trips)
  df <- na.omit(df)
  
  df <- df %>%
    group_by(Segment.Name) %>%
    summarize(
      Total_Matched_Trips = sum(Count.of.Matched.Trips),
      Weighted_Average_Percentage = sum(Count.of.Matched.Trips *
                                          Percentage.of.Matched.Trips) /
        sum(Count.of.Matched.Trips)
      )
  df$Price_Period <- i
  df <- rename(df, Segment_Name = Segment.Name)
  data_list[[i]] <- df
}
df_p1 <- data_list[[1]]
df_p2 <- data_list[[2]]
df_p3 <- data_list[[3]]

## need to normalize data still

# df <- df %>%
#     mutate(
#       Normalized_Weighted_Avg_Percentage = (Weighted_Average_Percentage - min(Weighted_Average_Percentage, na.rm = TRUE)) / 
#                                            (max(Weighted_Average_Percentage, na.rm = TRUE) - min(Weighted_Average_Percentage, na.rm = TRUE))
#     )
```
